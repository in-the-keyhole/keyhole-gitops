


---
apiVersion: cloudfront.aws.upbound.io/v1beta1
kind: Distribution
metadata:
  annotations:
  labels:
    testing.upbound.io/example-name: keyhole-demo-dev
  name: keyhole-demo-dev
spec:
  forProvider:
    aliases:
    - keyhole-demo-dev.keyhole.institute
    comment: This is a demo application
    defaultCacheBehavior:
    - allowedMethods:
      - DELETE
      - GET
      - HEAD
      - OPTIONS
      - PATCH
      - POST
      - PUT
      cachedMethods:
      - GET
      - HEAD
      defaultTtl: 3600
      forwardedValues:
      - cookies:
        - forward: none
        queryString: false
      maxTtl: 86400
      minTtl: 0
      targetOriginId: s3_origin
      viewerProtocolPolicy: redirect-to-https
      compress: true
    defaultRootObject: index.html
    enabled: true
    isIpv6Enabled: true
    # loggingConfig:
    # - bucket: mylogs.s3.amazonaws.com
    #   includeCookies: false
    #   prefix: myprefix
    # orderedCacheBehavior:
    # - allowedMethods:
    #   - GET
    #   - HEAD
    #   - OPTIONS
    #   cachedMethods:
    #   - GET
    #   - HEAD
    #   - OPTIONS
    #   compress: true
    #   defaultTtl: 86400
    #   forwardedValues:
    #   - cookies:
    #     - forward: none
    #     headers:
    #     - Origin
    #     queryString: false
    #   maxTtl: 31536000
    #   minTtl: 0
    #   pathPattern: /content/immutable/*
    #   targetOriginId: ${local.s3_origin_id}
    #   viewerProtocolPolicy: redirect-to-https
    # - allowedMethods:
    #   - GET
    #   - HEAD
    #   - OPTIONS
    #   cachedMethods:
    #   - GET
    #   - HEAD
    #   compress: true
    #   defaultTtl: 3600
    #   forwardedValues:
    #   - cookies:
    #     - forward: none
    #     queryString: false
    #   maxTtl: 86400
    #   minTtl: 0
    #   pathPattern: /content/*
    #   targetOriginId: ${local.s3_origin_id}
    #   viewerProtocolPolicy: redirect-to-https
    origin:
    - domainName: keyhole-demo-dev-191.s3-website.us-east-2.amazonaws.com
      originId: s3_origin
      customOriginConfig:
      - httpPort: 80
        httpsPort: 443
        originProtocolPolicy: http-only
        originSslProtocols:
          - TLSv1
          - TLSv1.1
          - TLSv1.2
    priceClass: PriceClass_100
    region: us-east-2
    restrictions:
    - geoRestriction:
      - locations:
        - US
        - CA
        - GB
        - DE
        restrictionType: whitelist
    tags:
      Environment: development
    viewerCertificate:
    - cloudfrontDefaultCertificate: false
      acmCertificateArn: arn:aws:acm:us-east-1:999330780379:certificate/95bc1cd7-4d73-4499-9a64-8f883d551c56
      sslSupportMethod: sni-only

---
apiVersion: s3.aws.upbound.io/v1beta1
kind: Bucket
metadata:
  annotations:
  labels:
    testing.upbound.io/example-name: keyhole-demo-dev
  name: keyhole-demo-dev-191
spec:
  forProvider:
    region: us-east-2
    tags:
      Name: keyhole-demo-dev

---
apiVersion: s3.aws.upbound.io/v1beta1
kind: BucketWebsiteConfiguration
metadata:
  name: keyhole-demo-dev
spec:
  forProvider:
    bucketSelector:
      matchLabels:
        testing.upbound.io/example-name: keyhole-demo-dev
    errorDocument:
      - key: error.html
    indexDocument:
      - suffix: index.html
    region: us-east-2
    # routingRule:
    #   - condition:
    #       - keyPrefixEquals: docs/
    #     redirect:
    #       - replaceKeyPrefixWith: documents/

---
apiVersion: s3.aws.upbound.io/v1beta1
kind: BucketPolicy
metadata:
  annotations:
  labels:
    testing.upbound.io/example-name: keyhole-demo-dev-bucket-policy
  name: keyhole-demo-dev-bucket-policy
spec:
  forProvider:
    bucketSelector:
      matchLabels:
        testing.upbound.io/example-name: keyhole-demo-dev
    policy: >
      {
          "Version": "2012-10-17",
          "Statement": [
              {
                  "Sid": "PublicReadGetObject",
                  "Effect": "Allow",
                  "Principal": "*",
                  "Action": "s3:GetObject",
                  "Resource": "arn:aws:s3:::keyhole-demo-dev-191/*"
              }
          ]
      }
    region: us-east-2

---
apiVersion: route53.aws.upbound.io/v1beta1
kind: Record
metadata:
  name: keyhole-demo-dev
spec:
  forProvider:
    type: A
    zoneId: Z01786413D3NWMNM4V0CR
    name: keyhole-demo-dev.keyhole.institute
    region: us-east-1
    alias:
      - name: $(crossplane.ref("aws_cloudfront_distribution", $(var.generated_name)).domain_name)
        zoneId: Z2FDTNDATAQYW2
        evaluateTargetHealth: false